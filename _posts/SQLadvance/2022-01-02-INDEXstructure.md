---
title: "[Oracle] 인덱스 구조 파악하기"
description: "인덱스 구조 파악하기"
excerpt: "인덱스 구조 파악하기"
categories: SQLadvance
summary: 인덱스 기초 다지기, 인덱스란?
toc: true
toc_sticky: true
date: '2021-01-16 20:41:00 +0900'
tag : [SQL기초, 인덱스]
author_profile : true 
sidebar:
  nav: "sidebar-sample"
modifytime:
---

#####목차 
[인덱스기본구조](#1.-인덱스-기본구조)
[B+Tree구조](#2.-B+Tree-구조)
[문그림으로 B+Tree 이해하기](#3.-그림으로-B+Tree-이해하기)
[정리 ](#4.-정리 )

## 1. 인덱스 기본구조
 - 일반적으로 사용하는 구조는 B*tree 구조
 - B-Tree를 개선시킨 자료구조이다. B+Tree는 BTree와 다른 특성을 가지고 있다.
 - 테이블에 필요한 값만 검색하는 범위스캔을 이해하는데 필요한 구조.

 __B-Tree vs B+Tree 차이__
|B-Tree |B+tree |
|---|---|---|
|branch 노드에 key와 data를 담을 수 있다|브랜치 노드에 key 리프 노드에만 key와 data를 저장|
|루트부터 탐색 |노드끼리 Linked list로 연결되어 있다. |

 - B-Tree : branch 노드에 key와 data를 담을 수 있다.  B+tree : 브랜치 노드에 key만 담아두고,
 - B-Tree : 트리형식.  B+tree : 노드끼리 Linked list로 연결되어 있다.
  
## 2. B+Tree 구조
__1. 루트 블록__
  - 하위 노드를 찾아가기 위한 DBA(Data Block Address)를 가지고 있다.

__2. 브랜치블록__
  - 리프 블럭을 찾아 가기 위한 블럭 

__3. 리프블록__
  - 인덱스 키 컬럼이 존재
  - 해당 테이블 레코드를 찾아가기 위한 주소정보 (ROWID)가 존재
  - 항상 키 컬럼 순으로 정렬/ 키 값이 같을 떄는 rowid순으로 정렬 
  -  LinkedList으로 서로 연결되어 있다. (범위스캔 방식에 사용)


## 3. 그림으로 B+Tree 이해하기 

<img width="350" height='210'  src="https://user-images.githubusercontent.com/78027688/149657851-64b68f67-c624-4be1-a857-844e0d34fa62.png">
 
위 인덱스 맛보기에서 사용했던 예제를 B+Tree로 그려보자.
 (그림은 성과 이름이 별도 컬럼이지만 이해하기 쉽게 하나의 컬럼으로 설명해보자)

<img width="800"  src="https://user-images.githubusercontent.com/78027688/149655928-e9e8bf33-d03c-4b2c-adc2-91cb0c14b4e3.png">

##### 예제1. 아래 그림에서 다음 조건을 찾아보자.  WHERE 이름= '김고래'
>  ROOT -> 2번블록 -> 4번 블록 ->5번 블록(김사슴확인후 종료)
##### 예제2. 아래 그림에서 다음 조건을 찾아보자. WHERE 이름 >'김사슴'
>  ROOT -> 2번블록 -> 4번 블록 ->5번 블록 ->6번블록 ->7번블록 (브랜치블록을 다시 탐색할 필요가 없음)
##### 예제2. 아래 그림에서 다음 조건을 찾아보자. WHERE 이름 <'이고래'
>  ROOT -> 3번블록 -> 7번 블록 ->6번 블록 ->5번 블록 ->4번블록 (브랜치블록을 다시 탐색할 필요가 없음)
> 
__예제보고 정리하기__
__1. 루트 블록__
  - 인덱스 값에 따라 3번 브랜치 블록으로 갈지 3번블록으로 탐색해야하는지 확인 할 수 있다.

__2. 브랜치블록__
  - 2번 블록에서 실제 값이 존재하는 리프 블록으로 가기 위한 주소를 탐색할 수 있다.

__3. 리프블록__
  - LinkedList이기 때문에 이전 블록과 다음 블록 주소를 가지고 있다.
  - 인덱스 키에 해당하는 값들이 실제 존재한다. 
    (예 : 4번 블록 김고래. 김고래처럼 키값이 같은 경우 rowid로 정렬된다)
  - 위 그림에는 표현이 안되었지만 실제 테이블에 접근하기 위한 rowid도 같이 저장되어 있다.


## 4. 정리 
 - 인덱스의 구조형태는 B+Tree로 되어있다.
 - 리프블록까지 찾아가는 과정을 수직적 탐색이라 한다.
 - 리프블록에서 필요한 인덱스 데이터를 찾는 과정을 수평적 탐색이라고 한다.
 - 인덱스는 특정 값에 대해서만 검색하고 일치하지 않는 값에서 멈출수 있는 범위스캔을 도와준다.

***
<br>

